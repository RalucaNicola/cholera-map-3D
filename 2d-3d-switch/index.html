<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>John Snow Cholera Map 2D - 3D</title>

  <style>
    html, body, #sceneViewDiv, #mapViewDiv {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }
    #sceneViewDiv,
    #mapViewDiv {
      position: absolute;
      transition: 3000ms cubic-bezier(0.23, 1, 0.32, 1) 0ms opacity;
    }
    #sceneViewDiv.switch-on,
    #mapViewDiv.switch-on {
      opacity: 1;
      z-index: 2;
    }
    #sceneViewDiv.switch-off,
    #mapViewDiv.switch-off {
      opacity: 0.001;
      z-index: 1;
    }
    #switch-view {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 3;
    }
  </style>
  <link rel="stylesheet" href="https://js.arcgis.com/4.11/esri/themes/dark/main.css">
  <script src="https://js.arcgis.com/4.11/"></script>
  <script>
    var mapView;

    require({
      packages: [{
        name: "app",
        location: document.location.pathname + "../js/"
      }, {
        name: "lib",
        location: document.location.pathname + "../lib/"
      }]
    }, [
      "app/scene",
      "dojo/domReady!"
    ], function (scene) {
      scene.create();
    });

  </script>
  <script>
    require([
      "esri/WebMap",
      "esri/views/MapView",
      "app/scene",
    ], function (
      WebMap,
      MapView, scene) {
      const webmap = new WebMap({
        portalItem: {
          id: "faf112aa66e649fb8009ec68155cc809"
        }
      });

      mapView = new MapView({
        container: "mapViewDiv",
        map: webmap
      });

      var sceneView = scene.create();

      let is2D = true;
      // button that switches between 2D and 3D views
      const switchButton = document.getElementById("switch-view");
      switchButton.addEventListener("click", function () {
        is2D = !is2D;
        switchButton.innerHTML = is2D ? "Switch to 3D" : "Switch to 2D";
        switchView();
      });
      function switchView() {
        const newView = is2D ? mapView : sceneView;
        const oldView = is2D ? sceneView : mapView;
        newView.extent = oldView.extent;
        if (newView === sceneView) {
          newView.goTo({
            rotation: oldView.rotation,
            tilt: 0
          }, { animate: false })
            .then(function() {
              animateOpacity(newView, oldView);
              newView.goTo({
                tilt: 60
              }, {speedFactor: 0.3});
            });
        } else {
          oldView.goTo({
            tilt: 0
          })
            .then(function() {
              animateOpacity(newView, oldView);
              newView.rotation = 360 - oldView.camera.heading;
            });
        }
      }
      function animateOpacity(newView, oldView) {
        newView.container.classList.remove("switch-off");
        newView.container.classList.add("switch-on");
        oldView.container.classList.remove("switch-on");
        oldView.container.classList.add("switch-off");
      }
    });
  </script>
</head>

<body>
<div id="viewDiv" class="switch-off"></div>
<div id="mapViewDiv" class="switch-on"></div>
<button id="switch-view" class="demo-button"> Switch to 3D</button>
</body>

</html>