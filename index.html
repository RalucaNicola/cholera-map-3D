<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>John Snow Cholera Map 2D - 3D</title>
  <link href="https://fonts.googleapis.com/css?family=Euphoria+Script|Open+Sans&display=swap" rel="stylesheet">
  <style>
    html, body, #viewDiv, #mapViewDiv {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: 'Open Sans', serif;
      overflow: hidden;
    }

    .esri-attribution {
      display: none !important;
    }

    #viewDiv,
    #mapViewDiv {
      position: absolute;
      transition: 3000ms cubic-bezier(0.23, 1, 0.32, 1) 0ms opacity;
    }

    #viewDiv.switch-on,
    #mapViewDiv.switch-on {
      opacity: 1;
      z-index: 2;
    }

    #viewDiv.switch-off,
    #mapViewDiv.switch-off {
      opacity: 0.001;
      z-index: 1;
    }

    button {
      background-color: transparent;
      font-family: 'Euphoria Script', cursive;
      border: none;
      padding: 0.5em;
      color: white;
      display: block;
      font-size: 1.8em;
      margin: 10px auto;
      cursor: pointer;
    }
    button:hover{
      color: rgba(255, 255, 255, 0.8);
    }

    .infoPanel {
      position: relative;
      max-width: 400px;
      height:100%;
      z-index: 100;
      color: white;
      padding: 10px;
      padding: 10px 34px 40px 24px;
      line-height: 1.5em;
      text-align: justify;
      background-color: rgba(0,0,0,0.8);
    }
    .infoPanel h1 {
      font-family: 'Euphoria Script', cursive;
      font-size: 2.4em;
      line-height: 1.4em;
      font-weight: normal;
    }

    img {
      float: left;
      padding: 0.5em;
    }

  </style>
  <link rel="stylesheet" href="https://js.arcgis.com/4.11/esri/themes/dark/main.css">
  <script src="https://js.arcgis.com/4.11/"></script>
  <script>
    var mapView;

    require({
      packages: [{
        name: "app",
        location: document.location.pathname + "js/"
      }, {
        name: "lib",
        location: document.location.pathname + "lib/"
      }]
    }, [
      "app/scene",
      "dojo/domReady!"
    ], function (scene) {
      scene.create();
    });

  </script>
  <script>
    require([
      "esri/WebMap",
      "esri/views/MapView",
      "esri/core/promiseUtils",
      "app/scene",
    ], function (
      WebMap,
      MapView,
      promiseUtils,
      scene) {
      const webmap = new WebMap({
        portalItem: {
          id: "faf112aa66e649fb8009ec68155cc809"
        }
      });

      mapView = new MapView({
        container: "mapViewDiv",
        map: webmap
      });
      mapView.ui.move([ "zoom" ], "top-right");
      mapView.when(function(){
        webmap.ground.surfaceColor = '#ffffff';
        webmap.basemap = null;
      });

      var sceneView = scene.create();
      sceneView.ui.move([ "zoom", "navigation-toggle", "compass" ], "top-right");
      sceneView.padding = mapView.padding = {left: 300};

      let is2D = true;
      // button that switches between 2D and 3D views
      const switchButton = document.getElementById("switch-view");
      switchButton.addEventListener("click", function () {
        is2D = !is2D;
        switchButton.innerHTML = is2D ? "Switch to 3D →" : "← Switch to 2D";
        switchView();
      });

      function switchView() {
        const newView = is2D ? mapView : sceneView;
        const oldView = is2D ? sceneView : mapView;
        newView.extent = oldView.extent;
        if (newView === sceneView) {
          newView.goTo({
            rotation: oldView.rotation,
            tilt: 0
          }, {animate: false})
            .then(function () {
              animateOpacity(newView, oldView);
              return promiseUtils.after(1000)
            })
            .then(function () {
              newView.goTo({
                tilt: 60
              }, {speedFactor: 0.3});
            });
        } else {
          oldView.goTo({
            tilt: 0
          }, {speedFactor: 0.5})
            .then(function () {
              animateOpacity(newView, oldView);
              newView.rotation = 360 - oldView.camera.heading;
            });
        }
      }

      function animateOpacity(newView, oldView) {
        newView.container.classList.remove("switch-off");
        newView.container.classList.add("switch-on");
        oldView.container.classList.remove("switch-on");
        oldView.container.classList.add("switch-off");
      }
    });
  </script>
</head>

<body>
<div id="viewDiv" class="switch-off"></div>
<div id="mapViewDiv" class="switch-on"></div>
<div class="infoPanel panel2d">
  <h1>The cholera map that changed the world</h1>
  <div>
    <img src="assets/john_snow_crop.png">
  John Snow's map of cholera outbreaks from nineteenth century London changed how we saw a disease and is considered as one of the most inspirational examples of data journalism.
  In the world of the 1850s, cholera was believed to be spread by miasma in the air and the sudden and serious outbreak of cholera in London's Soho was a mystery.<br>
    His map essentially represented each death as a bar as you can see in his map on the right. It became apparent that the cases were clustered around the pump in Broad (now Broadwick) street, which was polluted by sewage from a nearby cesspit.
    <br>
    <br>
  This visualization worked for this particular case, but doesn't scale. Those bars could overlap, extend of streets or other features of the map and most importantly are hard to compare. They are aligned with each street, so opposite sides or perpendicular streets make a direct comparison difficult.
    This is why we created a new map and took his data to the third dimension.
  <button id="switch-view" class="demo-button"> Switch to 3D → </button>
  </div>
</div>
<div class="infoPanel panel3d">

</div>

</body>

</html>
